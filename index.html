<!DOCTYPE html>

<html>
<head>
  <title>TwistEGG</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
  <!--<script src="https://cdn.jsdelivr.net/npm/web3@0.20.1/dist/web3.js"></script>-->
<script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script >
    
    $(function(){
        if (window.web3) {
            // 有安裝 MetaMask
        } else {
            alert( 'You havn\'t install MetaMask' );
        }

    });
    

    async function Request(_a, address) { 
    
    	_a = parseInt(_a)
        let res = await contract.methods.Request(_a).send({from:address, value:0})
        // console.log(res.events.aPayment.returnValues.price);
        console.log(res);
    };
    
    
    window.web3 = new Web3(window.web3.currentProvider);
    //window.web3 = new Web3(window.ethereum);
    
    async function connect2metamask(_a) {
        
        let address;
        address = await ethereum.request({ method: 'eth_requestAccounts' })
        address = address[0]
    
        console.log(address)
        Request(_a, address);
        
        
    }
        
    
    async function chk_paused() { 
        let paused = await contract.methods.paused().call();        
        console.log(paused)
        if(paused) {
    		alert( 'EGG Twisting is no available now : PAUSED_BY_ADMIN' );
    	}
    };


    function load_ct(path) {$(document).ready(function() {
    	$.ajax({
        	url : path,
        	dataType: "text",
        	success : function (data) {
            	console.log(data);
                ct_addr = data;}});})
	};
    

    function load_abi(path) {$(document).ready(function() {
    	$.ajax({
        	url : path,
        	dataType: "text",
        	success : function (data) {
            	console.log(data);
                myABI = data;}});})
	};    

    var ct_addr; let myABI;
    load_ct ("./Contracts/hashB+A+B-DynamicArray-address-Rinkeby.txt");
    load_abi("./Contracts/hashB+A+B-DynamicArray-abi.txt")
    myABI = JSON.parse(myABI);
    let contract = new web3.eth.Contract(myABI, ct_addr);
    chk_paused()


    

</script>
</head>
<body class="container">
   <font color="#39c5bb" size=7 face="Comic Sans MS"><b><h1>Let's TwistEGG !! BETA</h1><b></font>

  

  <h5>Set A :</h5><input type="number" min="0" step="1" size="50" id="_a" />
  <a href="#" onclick="connect2metamask(document.getElementById('_a').value)" class="btn btn-primary">Request A!!!!</a>

</body>

</html>
